# 多语言国际化（i18n）说明

## 功能概述

系统现已支持多语言国际化（i18n），默认提供中文（简体）和英文两种语言，可根据需要轻松扩展更多语言。

## 已实现功能

### ✅ 前端国际化

1. **语言支持**
   - 🇨🇳 简体中文（zh-CN）
   - 🇺🇸 English（en-US）

2. **自动语言检测**
   - 优先读取用户上次选择的语言（localStorage）
   - 浏览器语言自动检测
   - 默认回退到简体中文

3. **完整翻译**
   - 登录/注册页面
   - 主页导航和菜单
   - 物资卡片和详情
   - 表单验证消息
   - 操作按钮和提示
   - Element Plus 组件

4. **语言切换**
   - 顶部语言切换按钮（地球图标🌐）
   - 实时切换，无需刷新
   - 自动保存用户选择

## 技术实现

### 依赖库

- **vue-i18n**: Vue 3 官方国际化插件
- **@element-plus/locale**: Element Plus 组件库国际化

### 文件结构

```
frontend/src/
├── locales/
│   ├── index.ts          # i18n 配置和初始化
│   ├── zh-CN.ts          # 简体中文语言包
│   └── en-US.ts          # 英文语言包
├── stores/
│   └── locale.ts         # 语言状态管理
└── components/
    └── LanguageSwitcher.vue  # 语言切换组件
```

### 语言包结构

```typescript
export default {
  common: {      // 通用词汇
    confirm: '确定',
    cancel: '取消',
    // ...
  },
  nav: {         // 导航菜单
    allMaterials: '全部物资',
    // ...
  },
  auth: {        // 认证相关
    login: '登录',
    register: '注册',
    // ...
  },
  material: {    // 物资管理
    name: '物资名称',
    type: '物资类型',
    // ...
  },
  statistics: {  // 统计数据
    title: '统计概览',
    // ...
  },
  error: {       // 错误消息
    networkError: '网络错误',
    // ...
  },
}
```

## 使用方法

### 1. 在组件中使用

```vue
<script setup lang="ts">
import { useI18n } from 'vue-i18n'

const { t } = useI18n()
</script>

<template>
  <!-- 基本用法 -->
  <h1>{{ t('auth.appTitle') }}</h1>
  
  <!-- 带参数 -->
  <p>{{ t('material.deleteConfirm', { name: material.name }) }}</p>
  
  <!-- 表单验证 -->
  <el-form-item :label="t('material.name')" />
</template>
```

### 2. 切换语言

用户可以通过以下方式切换语言：

1. **手动切换**：点击右上角地球图标，选择语言
2. **自动检测**：首次访问时根据浏览器语言自动选择

### 3. 添加新语言

#### 步骤 1：创建语言包

在 `frontend/src/locales/` 目录下创建新的语言文件，例如 `ja-JP.ts`（日语）：

```typescript
export default {
  common: {
    confirm: '確認',
    cancel: 'キャンセル',
    // ...
  },
  // ... 其他翻译
}
```

#### 步骤 2：注册语言

在 `frontend/src/locales/index.ts` 中注册新语言：

```typescript
import jaJP from './ja-JP'

export const SUPPORT_LOCALES = [
  { value: 'zh-CN', label: '简体中文', flag: '🇨🇳' },
  { value: 'en-US', label: 'English', flag: '🇺🇸' },
  { value: 'ja-JP', label: '日本語', flag: '🇯🇵' },  // 新增
]

const i18n = createI18n({
  // ...
  messages: {
    'zh-CN': zhCN,
    'en-US': enUS,
    'ja-JP': jaJP,  // 新增
  },
})
```

#### 步骤 3：添加 Element Plus 语言包

在 `frontend/src/stores/locale.ts` 中添加对应的 Element Plus 语言包：

```typescript
import ja from 'element-plus/es/locale/lang/ja'

const elementLocaleMap: Record<string, any> = {
  'zh-CN': zhCn,
  'en-US': en,
  'ja-JP': ja,  // 新增
}
```

### 4. 添加新的翻译项

在对应的语言文件中添加翻译：

```typescript
// zh-CN.ts
export default {
  // 在合适的分类下添加
  material: {
    // ... 现有翻译
    newField: '新字段名称',
  },
}

// en-US.ts
export default {
  material: {
    // ... 现有翻译
    newField: 'New Field Name',
  },
}
```

## 最佳实践

### 1. 翻译键命名规范

```typescript
// ✅ 推荐：使用分类和描述性命名
t('material.name')
t('auth.loginBtn')
t('common.confirm')

// ❌ 避免：直接使用中文或无意义的键
t('名称')
t('btn1')
```

### 2. 使用参数化翻译

```typescript
// 语言包定义
{
  deleteConfirm: '确定要删除物资"{name}"吗？',
}

// 使用
t('material.deleteConfirm', { name: material.name })
```

### 3. 复数和性别

vue-i18n 支持复数和性别处理：

```typescript
{
  items: '没有物资 | 1个物资 | {count}个物资',
}

// 使用
t('items', count)
```

### 4. 日期和数字格式化

```typescript
import { useI18n } from 'vue-i18n'

const { n, d } = useI18n()

// 数字格式化
n(1234.56, 'currency')  // ¥1,234.56 / $1,234.56

// 日期格式化
d(new Date(), 'long')   // 2024年1月1日 / January 1, 2024
```

## 语言切换持久化

系统会自动保存用户的语言选择：

1. **存储位置**：`localStorage.locale`
2. **生命周期**：永久保存（除非清除浏览器数据）
3. **优先级**：用户选择 > 浏览器语言 > 默认语言

## Element Plus 组件国际化

Element Plus 组件（如日期选择器、分页等）也会跟随系统语言自动切换：

```typescript
// main.ts 中已配置
import { useLocaleStore } from './stores/locale'

const localeStore = useLocaleStore()

app.use(ElementPlus, {
  locale: localeStore.elementLocale,  // 动态语言包
})
```

## 支持的语言包

### Element Plus 官方支持

- 简体中文（zh-cn）
- 繁体中文（zh-tw）
- 英文（en）
- 日语（ja）
- 韩语（ko）
- 德语（de）
- 法语（fr）
- 西班牙语（es）
- 等 40+ 种语言

完整列表：https://element-plus.org/zh-CN/guide/i18n.html

## 常见问题

### Q1: 新增的翻译不生效？

**A**: 检查以下几点：
1. 确认已在所有语言文件中添加翻译
2. 检查翻译键是否正确
3. 尝试清除浏览器缓存
4. 确认 i18n 配置正确

### Q2: 如何处理动态内容？

**A**: 使用参数化翻译：

```typescript
// 语言包
{
  greeting: 'Hello, {name}!',
}

// 使用
t('greeting', { name: userName })
```

### Q3: 如何翻译后端返回的错误消息？

**A**: 有两种方案：

**方案1**：后端返回错误代码，前端映射翻译
```typescript
// 后端返回
{ errorCode: 'EMAIL_EXISTS' }

// 前端翻译
t(`error.${errorCode}`)
```

**方案2**：后端支持多语言，根据请求头返回对应语言
```typescript
// 请求头添加语言
axios.defaults.headers['Accept-Language'] = locale.value
```

### Q4: 如何测试翻译完整性？

**A**: 可以创建测试脚本检查所有语言包的键是否一致：

```typescript
// scripts/check-i18n.ts
import zhCN from './locales/zh-CN'
import enUS from './locales/en-US'

function getKeys(obj: any, prefix = ''): string[] {
  let keys: string[] = []
  for (const key in obj) {
    const path = prefix ? `${prefix}.${key}` : key
    if (typeof obj[key] === 'object') {
      keys = keys.concat(getKeys(obj[key], path))
    } else {
      keys.push(path)
    }
  }
  return keys
}

const zhKeys = getKeys(zhCN)
const enKeys = getKeys(enUS)

const missingInEn = zhKeys.filter(k => !enKeys.includes(k))
const missingInZh = enKeys.filter(k => !zhKeys.includes(k))

console.log('Missing in EN:', missingInEn)
console.log('Missing in ZH:', missingInZh)
```

## 扩展阅读

- [Vue I18n 官方文档](https://vue-i18n.intlify.dev/)
- [Element Plus 国际化](https://element-plus.org/zh-CN/guide/i18n.html)
- [CLDR - Unicode 语言环境数据](http://cldr.unicode.org/)

## 贡献翻译

欢迎贡献更多语言的翻译！

1. Fork 项目
2. 创建新的语言包文件
3. 完成翻译
4. 提交 Pull Request

翻译质量要求：
- ✅ 准确性：翻译准确，符合语境
- ✅ 一致性：术语翻译保持一致
- ✅ 完整性：所有翻译项都已翻译
- ✅ 本地化：符合目标语言的表达习惯
